# =============================================================================
# Gitea Act Runner Configuration
# =============================================================================
# This configures how runners execute workflow jobs
# 
# IMPORTANT: Job containers need special networking to reach Gitea:
# - network: joins the gitea network so containers can use internal DNS
# - --add-host: allows containers to resolve the external domain
# =============================================================================

log:
  level: info

runner:
  file: .runner
  capacity: 2
  envs: {}
  env_file: .env
  timeout: 3h
  shutdown_timeout: 0s
  insecure: false
  fetch_timeout: 5s
  fetch_interval: 2s
  labels:
    - "ubuntu-latest:docker://docker.gitea.com/runner-images:ubuntu-latest"
    - "ubuntu-22.04:docker://docker.gitea.com/runner-images:ubuntu-22.04"
    - "ubuntu-24.04:docker://docker.gitea.com/runner-images:ubuntu-24.04"

cache:
  enabled: true
  dir: /data/cache
  host: ""
  port: 0
  external_server: ""

container:
  # CRITICAL: Connect job containers to gitea network
  # This allows them to resolve 'gitea' and other internal service names
  network: "terrarium-git_gitea-network"
  
  privileged: true
  
  # CRITICAL: Add host entry so job containers can resolve the external domain
  # 192.168.1.41 and terrarium-git.terrarium.network are replaced by the install script
  # Also mount docker socket for building images
  options: "-v /var/run/docker.sock:/var/run/docker.sock --add-host=terrarium-git.terrarium.network:192.168.1.41"
  
  workdir_parent:
  valid_volumes:
    - /var/run/docker.sock
    - /etc/ssl/certs
    - /etc/pki/ca-trust
  docker_host: ""
  force_pull: false
  force_rebuild: false

host:
  workdir_parent:
