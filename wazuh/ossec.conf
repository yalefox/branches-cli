<!--
  Wazuh Agent Configuration for Terrarium Services
  This file is mounted into the Wazuh agent container
  Docs: https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/index.html
-->
<ossec_config>
  <client>
    <server>
      <address>wazuh.terrarium.network</address>
      <port>1514</port>
      <protocol>tcp</protocol>
    </server>
    <enrollment>
      <enabled>yes</enabled>
      <manager_address>wazuh.terrarium.network</manager_address>
      <port>1515</port>
      <agent_name>terrarium-git</agent_name>
      <groups>terrarium-services,docker</groups>
    </enrollment>
  </client>

  <!-- Docker container log collection -->
  <localfile>
    <log_format>json</log_format>
    <location>/var/lib/docker/containers/*/*-json.log</location>
  </localfile>

  <!-- System logs -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <!-- File integrity monitoring -->
  <syscheck>
    <disabled>no</disabled>
    <frequency>43200</frequency>
    
    <!-- Monitor important directories -->
    <directories check_all="yes" realtime="yes">/opt/terrarium-git/data</directories>
    <directories check_all="yes">/etc</directories>
    
    <!-- Ignore these paths -->
    <ignore>/var/lib/docker/containers</ignore>
    <ignore>/var/log</ignore>
  </syscheck>

  <!-- Rootcheck (rootkit detection) -->
  <rootcheck>
    <disabled>no</disabled>
    <frequency>43200</frequency>
  </rootcheck>

  <!-- Active response -->
  <active-response>
    <disabled>no</disabled>
  </active-response>

  <!-- Log analysis -->
  <localfile>
    <log_format>audit</log_format>
    <location>/var/log/audit/audit.log</location>
  </localfile>
</ossec_config>
